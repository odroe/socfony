// Copyright (c) 2021, Odroe Inc. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

generator client {
  provider        = "echo \"Unnecessary\""
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "postgresql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model AccessToken {
  token              String   @id @db.Char(128)
  user_id            String   @db.Char(64)
  created_at         DateTime @default(now()) @db.Timestamptz
  expired_at         DateTime @db.Timestamptz
  refresh_expired_at DateTime @db.Timestamptz
  has_refreshed      Boolean  @default(false)

  @@index([user_id])
  @@index([created_at])
  @@index([expired_at])
  @@index([has_refreshed])
  @@index([refresh_expired_at])
  @@map("access_tokens")
}

model VerificationCode {
  phone      String
  code       String
  created_at DateTime @default(now()) @db.Timestamptz
  expired_at DateTime @db.Timestamptz

  @@id([phone, code])
  @@index([phone])
  @@index([code])
  @@index([expired_at])
  @@map("verification_codes")
}

model User {
  id         String   @id @db.Char(64)
  name       String?  @unique @db.VarChar(199)
  phone      String?  @unique @db.VarChar(199)
  created_at DateTime @default(now()) @db.Timestamptz

  @@index([created_at])
  @@index([name])
  @@index([phone])
  @@map("users")
}

model UserProfile {
  user_id  String  @id @db.Char(64)
  avatar   String?
  bio      String? @db.Text
  birthday Int?
  gender   Int     @default(3)

  @@index([birthday])
  @@map("user_profiles")
}

model Moment {
  id         String   @id @db.Char(64)
  title      String?
  content    String?  @db.Text
  media      Json?
  user_id    String   @db.Char(64)
  created_at DateTime @default(now()) @db.Timestamptz

  @@index([created_at])
  @@index([user_id])
  @@map("moments")
}
